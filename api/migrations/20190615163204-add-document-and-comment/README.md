# Migration `20190615163204-add-document-and-comment`

This migration has been generated by Peter Pistorius at 6/15/2019, 4:32:04 PM.
You can check out the [state of the datamodel](./datamodel.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "lift"."Document" ("id" INTEGER NOT NULL, "name" TEXT NOT NULL, "user" INTEGER REFERENCES User(id) NOT NULL, PRIMARY KEY ("id"));

CREATE TABLE "lift"."Comment" ("id" INTEGER NOT NULL, "comment" TEXT NOT NULL, "createdAt" DATE NOT NULL, "updatedAt" DATE NOT NULL, "user" INTEGER REFERENCES User(id) NOT NULL, "document" INTEGER REFERENCES Document(id), PRIMARY KEY ("id"));

PRAGMA foreign_keys=OFF;

CREATE TABLE "lift"."new_User" ("id" INTEGER NOT NULL, "username" TEXT NOT NULL, "name" TEXT, "isActive" BOOLEAN NOT NULL, "lastLogin" DATE NOT NULL, PRIMARY KEY ("id"));

INSERT INTO "new_User" ("id","username","name","isActive","lastLogin") SELECT "id","username","name","isActive","lastLogin" from "User"

DROP TABLE "lift"."User";

ALTER TABLE "lift"."new_User" RENAME TO "User";

PRAGMA "lift".foreign_key_check;

PRAGMA foreign_keys=ON;
```

## Changes

```diff
diff --git datamodel.mdl datamodel.mdl
migration 20190611210136-add user model..20190615163204-add-document-and-comment
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,33 @@
+datasource db {
+  provider = "sqlite"
+  url      = "file:db/dev.db"
+  default  = true
+}
+
+generator photon {
+  provider = "photogen"
+  output   = "./generated/photon"
+}
+
 model User {
-    id: Int @id
-    username: String @unique
-    name: String?
-    isActive: Boolean @default(true)
-    lastLogin: DateTime
+  id        Int       @id
+  username  String    @unique
+  name      String?
+  isActive  Boolean   @default(true)
+  lastLogin DateTime
 }
+
+model Document {
+  id        Int       @id
+  name      String
+  user      User
+  comments  Comment[]
+}
+
+model Comment {
+  id        Int       @id
+  user      User
+  comment   String
+  createdAt DateTime
+  updatedAt DateTime
+}
```

## Photon Usage

You can use a specific Photon built for this migration (20190615163204-add-document-and-comment)
in your `before` or `after` migration script like this:

```ts
import Photon from '@generated/photon/20190615163204-add-document-and-comment'

const photon = new Photon()

async function main() {
  const result = await photon.users()
  console.dir(result, { depth: null })
}

main()

```
